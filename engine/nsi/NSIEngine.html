<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>BetSense – NSI Engine</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Same base styles as other pages -->
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="page page--engine">
    <header class="top-nav">
      <a href="index.html" class="top-nav__brand">BetSense Quantum Sports Suite</a>
      <a href="index.html" class="top-nav__link">Back to main console</a>
    </header>

    <main class="engine-layout">
      <!-- STACK TAG -->
      <section class="engine-hero">
        <div class="stack-tag stack-tag--green">
          <span>BET SENSE AI STACK · NEURO SWITCH INDEX</span>
        </div>

        <h1 class="engine-title">NSI ENGINE</h1>

        <p class="engine-lede">
          Neuro Switch Index Engine – reads live match pressure, emotion and structure
          to highlight collapse risk, clutch potential and comeback windows that
          classic stats alone never see.
        </p>

        <div class="engine-meta-pill">
          <span>LAYER · NEURO BEHAVIOURAL EDGE ·</span>
          <span> LIVEDATA CONNECT READY</span>
        </div>
      </section>

      <!-- CONSOLE CARD -->
      <section class="engine-card">
        <header class="engine-card__header">
          <h2 class="engine-card__title">NSI DEMO CONSOLE</h2>
          <p class="engine-card__subtitle">
            Trigger a demo analysis from the NSI Engine and preview key risk /
            advantage signals. In production this layer runs on your own stacked
            feeds via LiveData Connect.
          </p>
        </header>

        <div class="engine-card__controls">
          <button id="nsi-demo-button" class="btn btn--primary">
            Run NSI demo analysis
          </button>

          <button id="nsi-health-button" class="btn btn--ghost">
            Check NSI health
          </button>

          <a href="live.html" class="btn btn--ghost">
            Back to main console
          </a>
        </div>

        <div class="engine-card__status-row">
          <div id="nsi-status-pill" class="status-pill status-pill--idle">
            <span class="status-pill__dot"></span>
            <span class="status-pill__text">Status · idle</span>
          </div>
        </div>

        <div class="engine-card__output">
          <h3 class="engine-card__output-title">Engine output</h3>
          <pre id="nsi-output" class="engine-card__output-body">
Press “Run NSI demo analysis” to see a sample payload here…
          </pre>
        </div>
      </section>
    </main>

    <!-- API base URL config -->
    <script src="api-config.js"></script>

    <!-- NSI wiring script -->
    <script>
      // Safe base URL (removes any trailing slash)
      const API_BASE = (window.API_BASE_URL || "https://betsense-backend.onrender.com")
        .replace(/\/+$/, "");

      const nsiDemoButton = document.getElementById("nsi-demo-button");
      const nsiHealthButton = document.getElementById("nsi-health-button");
      const nsiStatusPill = document.getElementById("nsi-status-pill");
      const nsiStatusText = nsiStatusPill.querySelector(".status-pill__text");
      const nsiOutput = document.getElementById("nsi-output");

      function setStatus(state, text) {
        nsiStatusPill.classList.remove(
          "status-pill--idle",
          "status-pill--loading",
          "status-pill--ok",
          "status-pill--error"
        );
        nsiStatusPill.classList.add("status-pill--" + state);
        nsiStatusText.textContent = text;
      }

      function prettyPrintJson(data) {
        try {
          return JSON.stringify(data, null, 2);
        } catch (e) {
          return String(data);
        }
      }

      async function callEndpoint(path, { loading, okLabel }) {
        setStatus("loading", loading);
        nsiOutput.textContent = "Loading…";

        try {
          const res = await fetch(API_BASE + path);
          const data = await res.json();

          if (!res.ok) {
            setStatus("error", "Error · " + (data.error || res.status));
            nsiOutput.textContent = prettyPrintJson(data);
            return;
          }

          setStatus("ok", okLabel);
          nsiOutput.textContent = prettyPrintJson(data);
        } catch (err) {
          setStatus("error", "Network error");
          nsiOutput.textContent = "Request failed:\\n" + err.message;
        }
      }

      nsiDemoButton.addEventListener("click", () => {
        callEndpoint("/api/nsi/demo", {
          loading: "Running NSI demo…",
          okLabel: "NSI demo analysis OK",
        });
      });

      nsiHealthButton.addEventListener("click", () => {
        callEndpoint("/api/nsi/health", {
          loading: "Checking NSI health…",
          okLabel: "NSI engine health OK",
        });
      });
    </script>
  </body>
</html>
